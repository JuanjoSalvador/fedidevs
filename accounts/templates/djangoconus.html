{% extends "layout.html" %}
{% load account_extras %}
{% load static %}
{% block head %}
  {% if posts.has_previous %}<meta name="robots" content="none">{% endif %}
{% endblock %}
{% block content %}
  <main class="container">
    <article>
      <header>
        <p>
          <a href="https://2023.djangocon.us">2023 DjangoCon US üêÇ</a> is taking place on October 16-20, 2023 in Durham Convention Center in Durham, NC. See the <a href="https://2023.djangocon.us/schedule/">Schedule</a>.
        </p>
        <p>
          There have been <mark>{{ total_posts }} posts</mark> and <mark>{{ total_favourites }} favourites</mark> with the hashtags <a href="https://fosstodon.org/tags/DjangoCon">#djangocon</a> or <a href="https://fosstodon.org/tags/DjangoConUS">#djangoconus</a> on <a href="https://joinmastodon.org">Mastodon</a> during the conference. Add to the conversation by posting those hashtags on Mastodon!
        </p>
        <nav>
          <ul style="flex-wrap: wrap; justify-content: center;">
            <li>
              <a href="{% url 'djangoconus' %}"
                 {% if posts_date is not None %}class="outline" style="border-color: rgb(231, 75, 26); color: rgb(231, 75, 26)" {% else %} style="border-color: rgb(231, 75, 26); color: white; background-color: rgb(231, 75, 26)" {% endif %}
                 role="button">All Days ({{ total_posts }})</a>
            </li>
            {% for date in dates %}
              <li>
                <a href="{% url 'djangoconus' date.value %}"
                   {% if posts_date != date.value %}class="outline" style="border-color: rgb(231, 75, 26); color: rgb(231, 75, 26)" {% else %} style="border-color: rgb(231, 75, 26); color: white; background-color: rgb(231, 75, 26)" {% endif %}
                   role="button">{{ date.pre_display }} ({{ date.count }})</a>
              </li>
            {% endfor %}
          </ul>
          <ul>
            <li>
              <script>
            function change_sort(element) {
              var date = document.getElementById("day_filter").value;
              if (date) {
                  window.location.href = "/posts/" + date + "/djangoconus23?order=" + element.value ;
              } else {
                  window.location.href = "/posts/djangoconus23?order=" + element.value ;
              }
            }
              </script>
              <select onchange="change_sort(this)">
                <option value="" disabled>Sort By</option>
                <option value="-favourites_count"
                        {% if order == "-favourites_count" %}selected{% endif %}>Sort by Number of Favourites</option>
                <option value="-created_at"
                        {% if order == "-created_at" %}selected{% endif %}>Sort by Created Date</option>
              </select>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <section data-nosnippet>
      {% for post in posts %}
        <div style="padding: 20px 0px;">
          <img class="avatar"
               src="{{ post.account.avatar }}"
               alt="{{ post.account.login }}"
               width="100"
               height="100" />
          <a href="{{ post.account.url }}"
             target="_blank"
             style="display:inline-block;
                    white-space: nowrap">{% render_emojis post.account.display_name post.account.emojis %}</a>
        </div>
        {% if post.sensitive %}
          <div>{{ post.spoiler_text }}</div>
        {% else %}
          {{ post.content|safe }}
          {% if post.media_attachments %}
            <div>
              {% for media in post.media_attachments %}
                {% if media.type == "image" %}
                  <img src="{{ media.preview_url }}"
                       alt="{{ media.description }}"
                       style="max-height: 300px" />
                {% endif %}
                {% if media.type == "video" %}
                  <video controls style="max-height: 300px">
                    <source src="{{ media.url }}" type="{{ media.meta.mime_type }}">
                    Your browser does not support the video tag.
                  </video>
                {% endif %}
                {% if media.type == "gifv" %}
                  <video autoplay loop muted style="max-height: 300px">
                    <source src="{{ media.url }}" type="{{ media.meta.mime_type }}">
                    Your browser does not support the video tag.
                  </video>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
          {% if not post.media_attachments and post.card %}
            <article class="card" style="max-width: 350px">
              <a href="{{ post.card.url }}" target="_blank">
                {% if post.card.image %}
                  <img src="{{ post.card.image }}"
                       alt="{{ post.card.title }}"
                       width="100%"
                       height="auto" />
                {% endif %}
              </a>
              <footer>
                <h3>
                  <a href="{{ post.card.url }}" target="_blank">{{ post.card.title }}</a>
                </h3>
                <small>{{ post.card.description }}</small>
              </footer>
            </article>
          {% endif %}
        {% endif %}
        <div>
          <small>
            {% heroicon_outline 'star' %} {{ post.favourites_count }} | {% heroicon_outline 'arrow-path-rounded-square' %} {{ post.reblogs_count }} | {% heroicon_outline 'chat-bubble-bottom-center' %} {{ post.replies_count }} |
            <a href="{{ post.uri }}">
              <span>{{ post.created_at }}</span>
            </a>
          </small>
        </div>
        <hr>
      {% endfor %}
      {% if not posts %}<p style="text-align:center;">No results, please check back later!</p>{% endif %}
    </section>
    <footer>
      <div class="pagination">
        <span class="step-links">
          {% if posts.has_previous %}
            <a href="?page={{ posts.previous_page_number }}&q={{ query }}&order={{ order }}">&laquo; previous</a>
          {% endif %}
          {% if posts %}<span class="current">Page {{ posts.number }} of {{ posts.paginator.num_pages }}</span>{% endif %}
          {% if posts.has_next %}
            <a href="?page={{ posts.next_page_number }}&q={{ query }}&order={{ order }}">next &raquo;</a>
          {% endif %}
        </span>
      </div>
      <p>
        Check out the <a href="{% url "faq" %}">FAQ</a> to learn how to add yourlsef to the list.
      </p>
    </footer>
  </article>
</main>
{% endblock %}
